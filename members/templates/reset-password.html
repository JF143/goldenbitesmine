{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Password - Golden Bites</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Ensure Inter font is used */
    }

    body {
      background-color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    /* Container */
    .container {
      width: 100%;
      max-width: 430px;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 30px;
      position: relative;
    }

    /* Auth Header */
    .auth-header {
      margin-bottom: 20px;
      position: relative;
    }

    .back-icon {
      position: absolute;
      top: 0;
      left: 0;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      color: #333;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      font-size: 14px;
      color: #666;
      text-align: center;
    }

    /* Divider */
    .divider {
      height: 1px;
      background-color: #eee;
      margin: 20px 0;
    }

    /* Form */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      height: 48px;
      padding: 0 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #4a7bca;
    }

    /* Password Input Container */
    .password-input-container {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }

    .eye-icon {
      width: 20px;
      height: 20px;
      opacity: 0.5;
    }

    /* Email Display */
    .email-display {
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .email-display span:first-child {
      color: #666;
    }

    .email-display span:last-child {
      font-weight: 500;
      color: #333;
    }

    /* Message Container */
    .message-container {
      margin-bottom: 20px;
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }

    .message-container.error {
      background-color: #ffebee;
      color: #d32f2f;
      display: block;
    }

    .message-container.success {
      background-color: #e8f5e9;
      color: #388e3c;
      display: block;
    }

    /* Button */
    .btn {
      display: block;
      width: 100%;
      height: 48px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .btn-primary {
      background-color: #4a7bca;
      color: white;
    }

    .btn-primary:hover {
      background-color: #3a6cb8;
    }

    /* Login Prompt */
    .login-prompt {
      margin-top: 20px;
      text-align: center;
      font-size: 14px;
      color: #666;
    }

    .login-link {
      color: #4a7bca;
      text-decoration: none;
      font-weight: 500;
    }

    .login-link:hover {
      text-decoration: underline;
    }

    /* Responsive Design */
    @media (max-width: 480px) {
      .container {
        padding: 20px;
      }
      
      .title {
        font-size: 20px;
      }
      
      .form-input, .btn {
        height: 44px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
      <div class="auth-header">
          <div class="back-icon" id="back-btn">&#8592;</div>
          <h1 class="title">Reset Password</h1>
          <p class="subtitle">Create a new password for your account</p>
      </div>
      <div class="divider"></div>
      <form id="resetPasswordForm">
          <div class="email-display">
              <span>Email: </span>
              <span id="emailDisplay">user@example.com</span>
          </div>
          
          <div class="form-group">
              <label class="form-label">New Password</label>
              <div class="password-input-container">
                  <input type="password" name="newPassword" id="newPassword" class="form-input" placeholder="Enter new password" required>
                  <div class="password-toggle" onclick="togglePasswordVisibility('newPassword', this)">
                      <img src="{% static 'assets/eye-close.png' %}" alt="Toggle Password" class="eye-icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWV5ZS1vZmYiPjxwYXRoIGQ9Ik0xNy45NCAxNy45NEExMC4wNyAxMC4wNyAwIDAgMSAxMiAyMGMtNyAwLTExLTgtMTEtOGExOC40NSAxOC40NSAwIDAgMSA1LjA2LTUuOTRNOS45IDQuMjRBOS4xMiA5LjEyIDAgMCAxIDEyIDRjNycgMCAxMSA4IDExIDhhMTguNSAxOC41IDAgMCAxLTIuMTYgMy4xOW0tNi43Mi0xLjA3YTMgMyAwIDEgMS00LjI0LTQuMjQiLz48bGluZSB4MT0iMSIgeTE9IjEiIHgyPSIyMyIgeTI9IjIzIi8+PC9zdmc+';">
                  </div>
              </div>
          </div>
          
          <div class="form-group">
              <label class="form-label">Confirm Password</label>
              <div class="password-input-container">
                  <input type="password" name="confirmPassword" id="confirmPassword" class="form-input" placeholder="Confirm new password" required>
                  <div class="password-toggle" onclick="togglePasswordVisibility('confirmPassword', this)">
                      <img src="{% static 'assets/eye-close.png' %}" alt="Toggle Password" class="eye-icon" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWV5ZS1vZmYiPjxwYXRoIGQ9Ik0xNy45NCAxNy45NEExMC4wNyAxMC4wNyAwIDAgMSAxMiAyMGMtNyAwLTExLTgtMTEtOGExOC40NSAxOC40NSAwIDAgMSA1LjA2LTUuOTRNOS45IDQuMjRBOS4xMiA5LjEyIDAgMCAxIDEyIDRjNyAwIDExIDggMTEgOGExOC41IDE4LjUgMCAwIDEtMi4xNiAzLjE5bS02LjcyLTEuMDdhMyAzIDAgMSAxLTQuMjQtNC4yNCIvPjxsaW5lIHgxPSIxIiB5MT0iMSIgeDI9IjIzIiB5Mj0iMjMiLz48L3N2Zz4=';">
                  </div>
              </div>
          </div>
          
          <div id="resetPasswordMessage" class="message-container"></div>
          
          <button type="submit" class="btn btn-primary">Reset Password</button>
          
          <div class="login-prompt">
              Remember your password? <a href="{% url 'sign_in' %}" class="login-link">Login</a>
          </div>
      </form>
  </div>

  <script>
    // Get email from URL parameters or localStorage
    document.addEventListener('DOMContentLoaded', function() {
      // Try to get email from URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const email = urlParams.get('email') || localStorage.getItem('resetEmail') || 'user@example.com';
      
      // Display email
      document.getElementById('emailDisplay').textContent = email;
      
      // Store email in localStorage for later use
      localStorage.setItem('resetEmail', email);
      
      // Add event listener to back button
      document.getElementById('back-btn').addEventListener('click', function() {
        window.history.back();
      });
    });

    // Toggle password visibility
    function togglePasswordVisibility(inputId, toggleElement) {
      const passwordInput = document.getElementById(inputId);
      const eyeIcon = toggleElement.querySelector('.eye-icon');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.src = "{% static 'assets/eye-open.png' %}"; // Use Django static tag
        // Fallback for missing image
        eyeIcon.onerror = function() {
          this.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWV5ZSI+PHBhdGggZD0iTTIgMTJzMy02IDEwLTYgMTAgNiAxMCA2LTMgNi0xMCA2LTEwLTYtMTAtNloiLz48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIi8+PC9zdmc+';
        };
      } else {
        passwordInput.type = 'password';
        eyeIcon.src = "{% static 'assets/eye-close.png' %}"; // Use Django static tag
        // Fallback for missing image
        eyeIcon.onerror = function() {
          this.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWV5ZS1vZmYiPjxwYXRoIGQ9Ik0xNy45NCAxNy45NEExMC4wNyAxMC4wNyAwIDAgMSAxMiAyMGMtNyAwLTExLTgtMTEtOGExOC40NSAxOC40NSAwIDAgMSA1LjA2LTUuOTRNOS45IDQuMjRBOS4xMiA5LjEyIDAgMCAxIDEyIDRjNycgMCAxMSA4IDExIDhhMTguNSAxOC41IDAgMCAxLTIuMTYgMy4xOWm-Ni43Mi0xLjA3YTMgMyAwIDEgMS00LjI0LTQuMjQiLz48bGluZSB4MT0iMSIgeTE9IjEiIHgyPSIyMyIgeTI9IjIzIi8+PC9zdmc+';
        };
      }
    }

    // Form submission handler
    document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const messageContainer = document.getElementById('resetPasswordMessage');
      
      // Clear previous messages
      messageContainer.innerHTML = '';
      messageContainer.className = 'message-container';
      
      // Validate passwords
      if (newPassword !== confirmPassword) {
        messageContainer.innerHTML = 'Passwords do not match!';
        messageContainer.classList.add('error');
        return;
      }
      
      if (newPassword.length < 8) {
        messageContainer.innerHTML = 'Password must be at least 8 characters long!';
        messageContainer.classList.add('error');
        return;
      }
      
      // Check for password strength
      const hasUpperCase = /[A-Z]/.test(newPassword);
      const hasLowerCase = /[a-z]/.test(newPassword);
      const hasNumbers = /\d/.test(newPassword);
      const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(newPassword);
      
      if (!(hasUpperCase && hasLowerCase && hasNumbers)) {
        messageContainer.innerHTML = 'Password must contain uppercase, lowercase letters and numbers!';
        messageContainer.classList.add('error');
        return;
      }
      
      if (!hasSpecialChar) {
        messageContainer.innerHTML = 'Password should include at least one special character!';
        messageContainer.classList.add('error');
        return;
      }
      
      // Simulate password reset success
      messageContainer.innerHTML = 'Password reset successful! Redirecting to login...';
      messageContainer.classList.add('success');
      
      // In a real app, you would send the new password to the server here
      try {
        // Store the email in localStorage for the login page
        const email = document.getElementById('emailDisplay').textContent;
        localStorage.setItem('lastResetEmail', email);
        
        // Clear the reset email
        localStorage.removeItem('resetEmail');
      } catch (e) {
        console.error('Error accessing localStorage:', e);
      }
      
      // Redirect to login page after 2 seconds
      setTimeout(() => {
        window.location.href = "{% url 'sign_in' %}"; // Use Django URL template tag
      }, 2000);
    });
  </script>
</body>
</html>
